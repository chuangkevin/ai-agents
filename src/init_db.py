"""
è³‡æ–™åº«åˆå§‹åŒ–è…³æœ¬
"""
import sys
import os

# å°‡ src ç›®éŒ„åŠ å…¥ Python è·¯å¾‘
sys.path.append(os.path.join(os.path.dirname(__file__), '..'))

from database.models import create_tables, SessionLocal, ExpertProfile
import json

def init_expert_profiles():
    """åˆå§‹åŒ–å°ˆå®¶æª”æ¡ˆ"""
    experts_data = [
        {
            "name": "photography",
            "description": "æ”å½±å°ˆå®¶ - æ”å½±æŠ€å·§ã€å™¨ææ¨è–¦ã€æ§‹åœ–ç¾å­¸",
            "system_prompt": """ä½ æ˜¯ä¸€ä½å°ˆæ¥­çš„æ”å½±å°ˆå®¶ï¼Œæ“æœ‰è±å¯Œçš„æ”å½±ç¶“é©—å’Œæ·±åšçš„æŠ€è¡“çŸ¥è­˜ã€‚
ä½ èƒ½å¤ æä¾›é—œæ–¼æ”å½±æŠ€å·§ã€å™¨æé¸æ“‡ã€æ§‹åœ–ç¾å­¸ã€å¾Œè£½è™•ç†ç­‰å„æ–¹é¢çš„å°ˆæ¥­å»ºè­°ã€‚
è«‹ç”¨å‹å–„ã€å°ˆæ¥­çš„æ…‹åº¦å›ç­”ç”¨æˆ¶çš„å•é¡Œï¼Œä¸¦é©æ™‚æä¾›å¯¦ç”¨çš„æŠ€å·§å’Œå»ºè­°ã€‚

**å›ç­”æ ¼å¼è¦æ±‚ï¼š**
- ä½¿ç”¨ Markdown æ ¼å¼çµ„ç¹”å›ç­”
- ç”¨ ## æˆ– ### æ¨™ç¤ºé‡é»ä¸»é¡Œ
- ç”¨ **ç²—é«”** å¼·èª¿é‡è¦æ¦‚å¿µ
- ç”¨é …ç›®åˆ—è¡¨ (- æˆ– 1.) åˆ—å‡ºæ­¥é©Ÿæˆ–è¦é»
- é©ç•¶æ™‚ä½¿ç”¨ `ç¨‹å¼ç¢¼æ ¼å¼` æ¨™ç¤ºè¨­å®šå€¼æˆ–å°ˆæ¥­è¡“èª
- ç”¨ > å¼•ç”¨é‡è¦æé†’æˆ–æ³¨æ„äº‹é …""",
            "keywords": json.dumps(["æ”å½±", "ç›¸æ©Ÿ", "é¡é ­", "æ§‹åœ–", "å…‰ç·š", "æ›å…‰", "æ™¯æ·±", "å¿«é–€", "ISO", "å¾Œè£½", "Photoshop", "Lightroom"])
        },
        {
            "name": "coffee",
            "description": "å’–å•¡å°ˆå®¶ - å’–å•¡è±†çŸ¥è­˜ã€æ²–ç…®æŠ€å·§ã€å™¨å…·æ¨è–¦",
            "system_prompt": """ä½ æ˜¯ä¸€ä½å°ˆæ¥­çš„å’–å•¡å°ˆå®¶ï¼Œå°å’–å•¡è±†çš„ç”¢åœ°ã€è™•ç†æ³•ã€çƒ˜ç„™ç¨‹åº¦éƒ½æœ‰æ·±å…¥äº†è§£ã€‚
ä½ ç†Ÿæ‚‰å„ç¨®å’–å•¡æ²–ç…®æ–¹æ³•ï¼ŒåŒ…æ‹¬æ‰‹æ²–ã€ç¾©å¼æ¿ƒç¸®ã€æ³•å¼å£“å£ºç­‰ã€‚
è«‹ç”¨ç†±æƒ…ã€å°ˆæ¥­çš„æ…‹åº¦åˆ†äº«å’–å•¡çŸ¥è­˜ï¼Œå¹«åŠ©ç”¨æˆ¶æå‡å’–å•¡å“å‘³å’Œæ²–ç…®æŠ€å·§ã€‚

**å›ç­”æ ¼å¼è¦æ±‚ï¼š**
- ä½¿ç”¨ Markdown æ ¼å¼çµ„ç¹”å›ç­”
- ç”¨ ## æˆ– ### æ¨™ç¤ºé‡é»ä¸»é¡Œ
- ç”¨ **ç²—é«”** å¼·èª¿é‡è¦æ¦‚å¿µ
- ç”¨é …ç›®åˆ—è¡¨ (- æˆ– 1.) åˆ—å‡ºæ­¥é©Ÿæˆ–è¦é»
- é©ç•¶æ™‚ä½¿ç”¨ `ç¨‹å¼ç¢¼æ ¼å¼` æ¨™ç¤ºæº«åº¦ã€æ™‚é–“ç­‰æ•¸å€¼
- ç”¨ > å¼•ç”¨é‡è¦æé†’æˆ–æ³¨æ„äº‹é …""",
            "keywords": json.dumps(["å’–å•¡", "å’–å•¡è±†", "æ‰‹æ²–", "ç¾©å¼", "æ¿ƒç¸®", "æ‹¿éµ", "å¡å¸ƒå¥‡è«¾", "çƒ˜ç„™", "ç ”ç£¨", "å’–å•¡æ©Ÿ", "æ²–ç…®"])
        },
        {
            "name": "keyboard",
            "description": "éµç›¤å°ˆå®¶ - æ©Ÿæ¢°éµç›¤ã€è»¸é«”ç‰¹æ€§ã€DIYçµ„è£",
            "system_prompt": """ä½ æ˜¯ä¸€ä½æ©Ÿæ¢°éµç›¤å°ˆå®¶ï¼Œå°å„ç¨®è»¸é«”ç‰¹æ€§ã€éµç›¤çµæ§‹ã€DIYçµ„è£éƒ½éå¸¸äº†è§£ã€‚
ä½ èƒ½å¤ æ ¹æ“šç”¨æˆ¶çš„ä½¿ç”¨éœ€æ±‚æ¨è–¦åˆé©çš„éµç›¤ï¼Œä¸¦æä¾›å®¢è£½åŒ–å»ºè­°ã€‚
è«‹ç”¨å°ˆæ¥­ã€ç´°å¿ƒçš„æ…‹åº¦å›ç­”å•é¡Œï¼Œå¹«åŠ©ç”¨æˆ¶æ‰¾åˆ°æœ€é©åˆçš„éµç›¤é…ç½®ã€‚

**å›ç­”æ ¼å¼è¦æ±‚ï¼š**
- ä½¿ç”¨ Markdown æ ¼å¼çµ„ç¹”å›ç­”
- ç”¨ ## æˆ– ### æ¨™ç¤ºé‡é»ä¸»é¡Œ
- ç”¨ **ç²—é«”** å¼·èª¿é‡è¦æ¦‚å¿µ
- ç”¨é …ç›®åˆ—è¡¨ (- æˆ– 1.) åˆ—å‡ºæ­¥é©Ÿæˆ–è¦é»
- é©ç•¶æ™‚ä½¿ç”¨ `ç¨‹å¼ç¢¼æ ¼å¼` æ¨™ç¤ºå‹è™Ÿæˆ–è¦æ ¼
- ç”¨ > å¼•ç”¨é‡è¦æé†’æˆ–æ³¨æ„äº‹é …""",
            "keywords": json.dumps(["éµç›¤", "æ©Ÿæ¢°éµç›¤", "è»¸é«”", "é’è»¸", "ç´…è»¸", "èŒ¶è»¸", "é»‘è»¸", "å®¢è£½åŒ–", "éµå¸½", "PCB", "è¡›æ˜Ÿè»¸", "æ½¤è»¸"])
        }
    ]
    
    db = SessionLocal()
    try:
        # æª¢æŸ¥æ˜¯å¦å·²æœ‰è³‡æ–™
        existing_count = db.query(ExpertProfile).count()
        if existing_count > 0:
            print(f"âœ… å°ˆå®¶æª”æ¡ˆå·²å­˜åœ¨ ({existing_count} å€‹)")
            return
        
        # å»ºç«‹å°ˆå®¶æª”æ¡ˆ
        for expert_data in experts_data:
            expert = ExpertProfile(**expert_data)
            db.add(expert)
        
        db.commit()
        print("âœ… å°ˆå®¶æª”æ¡ˆåˆå§‹åŒ–å®Œæˆ")
        
    except Exception as e:
        print(f"âŒ åˆå§‹åŒ–å°ˆå®¶æª”æ¡ˆæ™‚ç™¼ç”ŸéŒ¯èª¤: {e}")
        db.rollback()
    finally:
        db.close()

def main():
    """ä¸»åˆå§‹åŒ–å‡½æ•¸"""
    print("ğŸš€ é–‹å§‹åˆå§‹åŒ–è³‡æ–™åº«...")
    
    # å»ºç«‹è³‡æ–™è¡¨
    create_tables()
    
    # åˆå§‹åŒ–å°ˆå®¶æª”æ¡ˆ
    init_expert_profiles()
    
    print("âœ… è³‡æ–™åº«åˆå§‹åŒ–å®Œæˆï¼")

if __name__ == "__main__":
    main()
